FROM python:3.11

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# æ›´æ–°åŒ…åˆ—è¡¨å¹¶å®‰è£…ç³»ç»Ÿä¾èµ–å’Œè°ƒè¯•å·¥å…·
RUN apt-get update && apt-get install -y \
    # Playwright æµè§ˆå™¨ä¾èµ–
    wget \
    gnupg \
    ca-certificates \
    fonts-liberation \
    libasound2 \
    libatk-bridge2.0-0 \
    libdrm2 \
    libgtk-3-0 \
    libnspr4 \
    libnss3 \
    libx11-xcb1 \
    libxcomposite1 \
    libxdamage1 \
    libxrandr2 \
    xvfb \
    fonts-wqy-zenhei \
    fonts-wqy-microhei \
    fonts-noto-cjk \
    # åŸºç¡€å¼€å‘å’Œè°ƒè¯•å·¥å…·
    git \
    curl \
    wget \
    vim \
    nano \
    htop \
    tree \
    less \
    coreutils \
    gawk \
    sed \
    # ç½‘ç»œè°ƒè¯•å·¥å…·
    net-tools \
    iputils-ping \
    telnet \
    netcat-openbsd \
    nmap \
    # ç³»ç»Ÿç›‘æ§å·¥å…·
    procps \
    psmisc \
    lsof \
    strace \
    # æ–‡ä»¶å¤„ç†å·¥å…·
    zip \
    unzip \
    tar \
    gzip \
    # Python è°ƒè¯•å·¥å…·
    python3-dev \
    python3-pip \
    # å…¶ä»–æœ‰ç”¨å·¥å…·
    jq \
    sqlite3 \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£… Python ä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å®‰è£… Playwright æµè§ˆå™¨å’Œç³»ç»Ÿä¾èµ–

RUN python -m playwright install
RUN python -m playwright install chromium
RUN python -m playwright install-deps

# ä¸‹è½½ NLTK æ•°æ®
RUN python -c "import nltk; nltk.download('punkt'); nltk.download('punkt_tab'); nltk.download('stopwords'); nltk.download('wordnet'); nltk.download('averaged_perceptron_tagger')"

# ğŸ”¥ å¼€å‘ç¯å¢ƒï¼šä¸å¤åˆ¶ä»£ç ï¼Œè€Œæ˜¯é€šè¿‡æŒ‚è½½è·å–
# COPY . .  # <- è¿™è¡Œè¢«æ³¨é‡Šæ‰äº†

# åˆ›å»ºå¿…è¦çš„ç›®å½•ï¼ˆå¦‚æœæŒ‚è½½ç›®å½•ä¸å­˜åœ¨ï¼‰
RUN mkdir -p /app/data/logs /app/data/outputs /app/data/wechat_articles /app/data/processed_articles

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV PYTHONPATH=/app
ENV PLAYWRIGHT_BROWSERS_PATH=/root/.cache/ms-playwright

# æš´éœ²ç«¯å£
EXPOSE 18899

# å¯åŠ¨å‘½ä»¤
CMD ["python", "run.py"] 