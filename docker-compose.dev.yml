services:
  daily-digest:
    build: 
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "18899:18899"
    volumes:
      # ğŸ”¥ å…³é”®ï¼šæŒ‚è½½æ•´ä¸ªåº”ç”¨ä»£ç ç›®å½•ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
      # åŒ…æ‹¬ä»£ç æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€ä¾èµ–æ–‡ä»¶ç­‰ï¼Œä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ
      - .:/app
      # æ’é™¤ä¸€äº›ä¸éœ€è¦æŒ‚è½½çš„ç›®å½•ï¼Œé¿å…æ€§èƒ½é—®é¢˜
      - /app/__pycache__
      - /app/.git
      - /app/node_modules
      # æ•°æ®ç›®å½•æŒ‚è½½ï¼ˆç¡®ä¿ç›®å½•å­˜åœ¨ï¼‰
      - ./data:/app/data
      # æ•°æ®åº“æ–‡ä»¶æŒ‚è½½ï¼ˆå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰
      - ./daily_digest.db:/app/daily_digest.db
      # ç¯å¢ƒé…ç½®æ–‡ä»¶æŒ‚è½½
      - ./.env:/app/.env
    environment:
      - PYTHONPATH=/app
      - FLASK_ENV=development
    # restart: unless-stopped
    # å¼€å‘ç¯å¢ƒå¯ä»¥ç¦ç”¨å¥åº·æ£€æŸ¥ä»¥åŠ å¿«å¯åŠ¨
    # healthcheck:
    #   test: ["CMD", "curl", "-f", "http://localhost:18899/health"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 3
    #   start_period: 40s
    
  # å¯é€‰ï¼šæ·»åŠ  Redis ç”¨äºç¼“å­˜
  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
    restart: unless-stopped
    command: redis-server --appendonly yes

volumes:
  redis_data: 

networks:
  nginx-proxy-manager_npm_network:
    external: true 