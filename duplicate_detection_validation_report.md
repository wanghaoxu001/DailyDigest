# 重复新闻检测验证报告
**调查期间**: 2025-11-08 至 2025-11-11  
**生成时间**: 2025-11-11  
**调查方法**: 人工分析 + 相似度计算

---

## 一、执行摘要

### 关键发现
- **快报总数**: 4份
- **新闻总数**: 18条
- **发现重复**: ✅ **1对明显重复**（同一新闻ID重复发布）
- **潜在误报**: ❌ 无（在阈值0.7下）
- **系统漏报**: ✅ **存在严重漏报**

### 核心问题
当前阈值0.7导致**同一条新闻重复发布两次都未被检测**，这是最严重的重复类型。

---

## 二、数据概览

### 快报分布
| 快报ID | 创建日期 | 新闻数 |
|--------|----------|--------|
| 226 | 2025-11-11 06:27:22 | 3 |
| 225 | 2025-11-10 08:48:31 | 7 |
| 224 | 2025-11-09 08:06:22 | 2 |
| 223 | 2025-11-08 07:30:11 | 6 |

---

## 三、重复新闻详细分析

### 【确认重复】新闻ID 16953 - 完全相同的新闻

**问题严重性**: 🔴 **严重** - 同一条新闻重复发布

**新闻信息**:
- **新闻ID**: 16953
- **标题**: 印尼交通部数据泄露事件致246GB敏感文件外泄
- **发布日期**: 2025-11-09 19:01:13
- **重复情况**: 
  - 快报225 (2025-11-10 08:48:31)
  - 快报226 (2025-11-11 06:27:22)

**相似度分析**:
```
标题相似度: 1.0000 (完全相同)
摘要相似度: 1.0000 (完全相同)

检测结果:
  阈值0.7:  ✅ 应该能检测（相似度1.0 > 0.7）
  阈值0.30: ✅ 应该能检测（相似度1.0 > 0.30）
```

**根本原因**: 
这是数据库级别的重复 - 同一条news记录被关联到两份不同的快报。这种情况下，相似度为1.0（完全相同），理论上任何合理的阈值都应该能检测到。

**为什么没有被检测到**:
根据之前的日志分析，4天内1104次比较全部被**预筛选跳过**。可能原因：
1. 预筛选逻辑过于严格（如基于发布日期过滤）
2. 检测系统在快报生成时未运行
3. 跨快报的重复检测被禁用

---

## 四、潜在语义重复检查

虽然发现了一对完全相同的重复，但也需要检查是否存在语义相似但被正确区分的新闻对：

### 案例1: 西班牙两家公司的数据泄露

**新闻1** (ID 16943, 快报226):
- 标题: 维耶索戈数据泄露事件曝光银行信息与个人身份标识
- 公司: 西班牙维耶索能源公司

**新闻2** (ID 16898, 快报224):
- 标题: 桑坦德银行数据泄露事件导致一万名西班牙客户信息曝光
- 公司: 桑坦德银行

**相似度分析**:
```
标题相似度: 0.4000
阈值0.7判定:  ✅ 不重复 (0.4000 < 0.7)
阈值0.30判定: 🔴 判为重复 (0.4000 > 0.30)
人工判断:     ✅ 确实不重复（不同公司、不同事件）
```

**结论**: 阈值0.30会产生**误报**，0.7正确。

---

### 案例2: 菲律宾两个机构的数据泄露

**新闻1** (ID 16782, 快报223):
- 标题: 菲律宾国家警察数据泄露致41.4万警员档案曝光
- 机构: 菲律宾国家警察

**新闻2** (ID 16821, 快报223):
- 标题: 邦板牙省政府数据泄露事件致130万公民记录曝光
- 机构: 菲律宾邦板牙省政府

**相似度分析**:
```
标题相似度: 0.2941
阈值0.7判定:  ✅ 不重复 (0.2941 < 0.7)
阈值0.30判定: ✅ 不重复 (0.2941 < 0.30)
人工判断:     ✅ 确实不重复（不同机构、不同事件）
```

**结论**: 两个阈值均正确。

---

## 五、全量新闻列表检查

### 快报226 (2025-11-11) - 3条新闻
1. 16943 - 维耶索戈数据泄露事件（西班牙能源公司）
2. **16953 - 印尼交通部数据泄露** ⚠️ **重复**
3. 17211 - Sinobi黑客组织攻击宏基金属（勒索软件）

### 快报225 (2025-11-10) - 7条新闻
1. **16953 - 印尼交通部数据泄露** ⚠️ **重复**
2. 16973 - 安讯士通信公司数据泄露（源代码泄露）
3. 16974 - 富达养老金数据泄露（尼日利亚）
4. 16976 - 东开普省人居部数据泄露（南非）
5. 16986 - 内华达州政府遭勒索软件攻击（美国）
6. 17063 - 恶意NuGet包威胁西门子S7 PLC（供应链攻击）
7. 17074 - APT组织瞄准建筑企业（APT攻击）

### 快报224 (2025-11-09) - 2条新闻
1. 16898 - 桑坦德银行数据泄露（西班牙银行）
2. 16908 - 新莱诺克斯数据泄露（美国市政府）

### 快报223 (2025-11-08) - 6条新闻
1. 16615 - Clop攻击华盛顿邮报（勒索软件）
2. 16739 - CIH数据泄露（美国商业公司）
3. 16766 - Simon Property Group遭攻击（美国金融）
4. 16782 - 菲律宾国家警察数据泄露
5. 16820 - 麦迪逊医疗数据泄露（美国医疗）
6. 16821 - 菲律宾邦板牙省政府数据泄露

---

## 六、统计分析

### 重复情况统计
- **完全重复（同一ID）**: 1对 (新闻16953)
- **语义重复**: 0对
- **误判风险（相似但不重复）**: 1对 (西班牙案例，在阈值0.30下)

### 重复率计算
```
重复新闻数: 1条（16953出现2次，算作1条重复）
总新闻数: 18条（实际独立新闻17条）
重复率: 1/17 = 5.88%
```

### 检测效果评估
```
应检测到的重复: 1对
实际检测到: 0对（根据之前日志，1104次比较全部被预筛选跳过）
漏报数: 1对
漏报率: 100%
```

---

## 七、根本原因分析

### 为什么会出现重复？
1. **新闻16953**: 发布于2025-11-09 19:01，但被包含在10日和11日的两份快报中
2. 可能原因：
   - 新闻生成系统在不同时间抓取到同一条新闻
   - 缺少跨快报的去重检查
   - 新闻ID应该是唯一的，但digest_news表允许同一news_id关联多个digest_id

### 为什么没有被检测到？
根据2025-11-10的日志分析：
```
4天内比较统计:
  总比较次数: 1104
  预筛选跳过: 1104 (100%)
  实际计算: 0
```

**关键问题**:
1. **预筛选过于严格**: 所有比较都被预筛选跳过，连相似度计算都没有执行
2. **可能的预筛选条件**:
   - 基于发布时间差异（但新闻16953在两份快报中的发布日期相同）
   - 基于news_id去重（但实际未生效）
   - 基于来源或URL去重（但未阻止重复添加到快报）

---

## 八、结论与建议

### 主要发现
1. ✅ **确认存在重复**: 同一条新闻（ID 16953）在连续两天的快报中重复出现
2. ❌ **检测系统失效**: 相似度1.0的完全重复未被检测，漏报率100%
3. ✅ **阈值设置合理**: 在当前新闻集中，0.7的阈值在避免误报方面表现正确（西班牙案例相似度0.40未被误判）
4. ⚠️ **预筛选问题**: 根本原因不是阈值太高，而是预筛选逻辑将所有比较都跳过了

### 建议优先级

#### 🔴 紧急 - 修复预筛选逻辑
```python
# 当前问题: 1104次比较全部被预筛选跳过
# 建议: 检查并修复预筛选条件，确保至少对新新闻进行相似度计算
```

#### 🟡 中等 - 添加数据库层面的唯一性约束
```sql
-- 防止同一news_id被添加到多份快报
CREATE UNIQUE INDEX idx_unique_digest_news ON digest_news(news_id, digest_id);
```

#### 🟢 建议 - 暂时保持阈值0.7
- 在当前数据集中，0.7避免了误报（西班牙案例）
- 但需要先修复预筛选，让系统真正运行起来
- 然后再用更多数据评估是否需要调整阈值

#### 🔵 增强 - 添加快报生成前的去重检查
```python
# 在将新闻添加到快报前，检查该news_id是否已在最近N天的快报中
def check_news_already_in_recent_digests(news_id: int, days: int = 7) -> bool:
    # ...
```

---

## 九、附录：检测方法说明

### 相似度计算方法
使用系统的`calculate_simple_text_similarity`函数，该函数：
- 综合考虑标题和摘要的相似度
- 支持中文和英文文本
- 返回0-1之间的相似度分数

### 人工判断标准
- 同一事件、同一实体 → 重复
- 相同类型事件但不同实体 → 不重复
- 相同地区但不同事件 → 不重复

### 数据获取
```sql
-- 查询4天快报
SELECT id, title, created_at FROM digests 
WHERE created_at >= '2025-11-08' 
ORDER BY created_at DESC;

-- 查询每份快报的新闻
SELECT n.id, n.generated_title, n.generated_summary, n.publish_date
FROM news n
JOIN digest_news dn ON n.id = dn.news_id
WHERE dn.digest_id = ?;
```

---

**报告结论**: 当前系统存在**严重的漏报问题**，但根本原因不是阈值太高，而是**预筛选逻辑过于严格**导致所有比较都被跳过。建议优先修复预筛选逻辑，然后再评估阈值设置。
